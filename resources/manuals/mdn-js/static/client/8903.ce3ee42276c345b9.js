export const __rspack_esm_id="8903";export const __rspack_esm_ids=["8903"];export const __webpack_modules__={30994(e,t,i){i.d(t,{Gh:()=>s,HT:()=>c,Kp:()=>a,OM:()=>o,Tg:()=>d,Tv:()=>r,cp:()=>n,zh:()=>l});let n="glean_ping_info",r="glean_client_info",a="c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0",s="https://incoming.telemetry.mozilla.org",o="deletion-request",l="#glean_reference_time",c="#glean_execution_counter",d=[c,l]},27604(e,t,i){i.d(t,{o:()=>Context});var n=i(80849);let r="core.Context";let Context=class Context{constructor(){this.initialized=!1,this.testing=!1,this.supportedMetrics={},this.startTime=new Date}static get instance(){return Context._instance||(Context._instance=new Context),Context._instance}static testUninitialize(){Context._instance=void 0}static get uploadEnabled(){return void 0===Context.instance.uploadEnabled&&(0,n.A)(r,["Attempted to access Context.uploadEnabled before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.uploadEnabled}static set uploadEnabled(e){Context.instance.uploadEnabled=e}static get metricsDatabase(){return void 0===Context.instance.metricsDatabase&&(0,n.A)(r,["Attempted to access Context.metricsDatabase before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.metricsDatabase}static set metricsDatabase(e){Context.instance.metricsDatabase=e}static get eventsDatabase(){return void 0===Context.instance.eventsDatabase&&(0,n.A)(r,["Attempted to access Context.eventsDatabase before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.eventsDatabase}static set eventsDatabase(e){Context.instance.eventsDatabase=e}static get pingsDatabase(){return void 0===Context.instance.pingsDatabase&&(0,n.A)(r,["Attempted to access Context.pingsDatabase before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.pingsDatabase}static set pingsDatabase(e){Context.instance.pingsDatabase=e}static get errorManager(){return void 0===Context.instance.errorManager&&(0,n.A)(r,["Attempted to access Context.errorManager before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.errorManager}static set errorManager(e){Context.instance.errorManager=e}static get applicationId(){return void 0===Context.instance.applicationId&&(0,n.A)(r,["Attempted to access Context.applicationId before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.applicationId}static set applicationId(e){Context.instance.applicationId=e}static get initialized(){return Context.instance.initialized}static set initialized(e){Context.instance.initialized=e}static get config(){return void 0===Context.instance.config&&(0,n.A)(r,["Attempted to access Context.config before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.config}static set config(e){Context.instance.config=e}static get startTime(){return Context.instance.startTime}static get testing(){return Context.instance.testing}static set testing(e){Context.instance.testing=e}static get corePings(){return Context.instance.corePings}static set corePings(e){Context.instance.corePings=e}static get coreMetrics(){return Context.instance.coreMetrics}static set coreMetrics(e){Context.instance.coreMetrics=e}static set platform(e){Context.instance.platform=e}static get platform(){return void 0===Context.instance.platform&&(0,n.A)(r,["Attempted to access Context.platform before it was set. This may cause unexpected behaviour."],n.q.Trace),Context.instance.platform}static isPlatformSet(){return!!Context.instance.platform}static getSupportedMetric(e){return Context.instance.supportedMetrics[e]}static addSupportedMetric(e,t){e in Context.instance.supportedMetrics||(Context.instance.supportedMetrics[e]=t)}}},40351(e,t,i){var n,r;i.d(t,{B:()=>n}),(r=n||(n={})).InvalidValue="invalid_value",r.InvalidLabel="invalid_label",r.InvalidState="invalid_state",r.InvalidOverflow="invalid_overflow",r.InvalidType="invalid_type"},34388(e,t,i){i.d(t,{A:()=>g});var n,r=i(27604),a=i(87484),s=i(67867),o=i(80849);let l="core.glean_metrics";var c=n||(n={});let d={pageLoad:new s.A({category:"glean",name:"page_load",sendInPings:["events"],lifetime:"ping",disabled:!1},["url","referrer","title"]),elementClick:new s.A({category:"glean",name:"element_click",sendInPings:["events"],lifetime:"ping",disabled:!1},["id","type","label","url","referrer","title"]),pageId:new a.Ay({category:"glean",name:"page_id",sendInPings:["events"],lifetime:"application",disabled:!1})};function u(e){r.o.initialized?d.elementClick.record(e):(0,o.A)(l,"Attempted to record element click event before Glean was initialized. This is a no-op.",o.q.Warn)}c.pageLoad=function(e){var t,i,n;r.o.initialized?(d.pageId.generateAndSet(),d.pageLoad.record({url:null!=(t=null==e?void 0:e.url)?t:"u">typeof window?window.location.href:"URL_NOT_PROVIDED_OR_AVAILABLE",referrer:null!=(i=null==e?void 0:e.referrer)?i:"u">typeof document?document.referrer:"REFERRER_NOT_PROVIDED_OR_AVAILABLE",title:null!=(n=null==e?void 0:e.title)?n:"u">typeof document?document.title:"TITLE_NOT_PROVIDED_OR_AVAILABLE"})):(0,o.A)(l,"Attempted to record a page load event before Glean was initialized. This is a no-op.",o.q.Warn)},c.handleClickEvent=function(e){let t,i=e.target.closest("[data-glean-id], [data-glean-type], [data-glean-label]");i&&u({...(t=i.dataset).gleanId&&{id:t.gleanId},...t.gleanType&&{type:t.gleanType},...t.gleanLabel&&{label:t.gleanLabel},url:"u">typeof window?window.location.href:"URL_NOT_PROVIDED_OR_AVAILABLE",referrer:"u">typeof document?document.referrer:"REFERRER_NOT_PROVIDED_OR_AVAILABLE",title:"u">typeof document?document.title:"TITLE_NOT_PROVIDED_OR_AVAILABLE"})},c.recordElementClick=u;let g=n},80849(e,t,i){var n,r;function a(e,t,i=n.Debug){let r=`(Glean.${e})`;Array.isArray(t)?console[i](r,...t):console[i](r,t)}i.d(t,{A:()=>a,q:()=>n}),(r=n||(n={})).Debug="debug",r.Info="info",r.Warn="warn",r.Error="error",r.Trace="trace"},82006(e,t,i){i.d(t,{j:()=>RecordedEvent});var n=i(30994),r=i(2277),a=i(88729),s=i(25740);let RecordedEvent=class RecordedEvent extends a.JW{constructor(e){super(e)}static withTransformedExtras(e,t){let i=t(e.extra||{});return{category:e.category,name:e.name,timestamp:e.timestamp,extra:i&&Object.keys(i).length>0?i:void 0}}addExtra(e,t){this.inner.extra||(this.inner.extra={}),this.inner.extra[e]=t}withoutReservedExtras(){return RecordedEvent.withTransformedExtras(this.get(),e=>Object.keys(e).filter(e=>!n.Tg.includes(e)).reduce((t,i)=>(t[i]=e[i],t),{}))}validate(e){if(!(0,r.Gv)(e))return{type:a.iF.Error,errorMessage:`Expected Glean event object, got ${typeof e}`};let t="category"in e&&(0,r.Kg)(e.category),i="name"in e&&(0,r.Kg)(e.name);if(!t||!i)return{type:a.iF.Error,errorMessage:`Unexpected value for "category" or "name" in event object: ${JSON.stringify(e)}`};if(!("timestamp"in e&&(0,r.Fq)(e.timestamp)&&e.timestamp>=0))return{type:a.iF.Error,errorMessage:`Event timestamp must be a positive integer, got ${JSON.stringify(e)}`};if(e.extra){if(!(0,r.Gv)(e.extra))return{type:a.iF.Error,errorMessage:`Expected Glean extras object, got ${typeof e}`};for(let[t,i]of Object.entries(e.extra)){let e=(0,s.oI)(t);if(e.type===a.iF.Error)return e;if(!(0,r.Kg)(i)&&!(0,r.Et)(i)&&!(0,r.Lm)(i))return{type:a.iF.Error,errorMessage:`Unexpected value for extra key ${t}: ${JSON.stringify(i)}`}}}return{type:a.iF.Success}}payload(){return RecordedEvent.withTransformedExtras(this.withoutReservedExtras(),e=>Object.keys(e).reduce((t,i)=>(t[i]=e[i].toString(),t),{}))}}},62209(e,t,i){i.d(t,{v:()=>MetricType});var n=i(27604),r=i(2277),a=i(84592);let MetricType=class MetricType{constructor(e,t,i){i&&n.o.addSupportedMetric(e,i),this.type=e,this.name=t.name,this.category=t.category,this.sendInPings=t.sendInPings,this.lifetime=t.lifetime,this.disabled=t.disabled,this.dynamicLabel=t.dynamicLabel}baseIdentifier(){return this.category.length>0?`${this.category}.${this.name}`:this.name}identifier(){let e=this.baseIdentifier();return(0,r.b0)(this.dynamicLabel)?e:(0,a.cW)(this)}shouldRecord(e){return e&&!this.disabled}testGetNumRecordedErrors(e,t=this.sendInPings[0]){return(0,r.xU)("testGetNumRecordedErrors")?n.o.errorManager.testGetNumRecordedErrors(this,e,t):0}}},88729(e,t,i){i.d(t,{JW:()=>Metric,c1:()=>MetricValidationError,iF:()=>r});var n,r,a=i(27604),s=i(40351);(n=r||(r={}))[n.Success=0]="Success",n[n.Error=1]="Error";let MetricValidationError=class MetricValidationError extends Error{constructor(e,t=s.B.InvalidType){super(e),this.type=t,this.name="MetricValidationError"}recordError(e){a.o.errorManager.record(e,this.type,this.message)}};let Metric=class Metric{constructor(e){this.inner=this.validateOrThrow(e)}get(){return this.inner}set(e){this.inner=e}validateOrThrow(e){let t=this.validate(e);if(t.type===r.Error)throw new MetricValidationError(t.errorMessage,t.errorType);return e}}},67867(e,t,i){i.d(t,{A:()=>EventMetricType,C:()=>InternalEventMetricType});var n,r=i(82006),a=i(62209),s=i(2277),o=i(27604),l=i(40351),c=i(88729),d=function(e,t,i,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i},u=function(e,t,i,n){if("a"===i&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let InternalEventMetricType=class InternalEventMetricType extends a.v{constructor(e,t){super("event",e),this.allowedExtraKeys=t}record(e,t=(0,s.bQ)()){if(!this.shouldRecord(o.o.uploadEnabled))return;let i=Date.now();try{let n=new r.j({category:this.category,name:this.name,timestamp:t,extra:e}),a={};if(e&&this.allowedExtraKeys)for(let[t,i]of Object.entries(e))if(this.allowedExtraKeys.includes(t))(0,s.Kg)(i)?a[t]=(0,s.Wl)(this,i,500):a[t]=i;else{o.o.errorManager.record(this,l.B.InvalidValue,`Invalid key index: ${t}`);continue}a.glean_timestamp=i.toString(),n.set({...n.get(),extra:a}),o.o.eventsDatabase.record(this,n)}catch(e){e instanceof c.c1&&e.recordError(this)}}testGetValue(e=this.sendInPings[0]){if((0,s.xU)("testGetValue","core.metrics.EventMetricType")){let t=o.o.eventsDatabase.getEvents(e,this);return t&&t.forEach(e=>{e.extra&&(delete e.extra.glean_timestamp,0==Object.keys(e.extra).length&&(e.extra=void 0))}),t}}};let EventMetricType=class EventMetricType{constructor(e,t){n.set(this,void 0),d(this,n,new InternalEventMetricType(e,t),"f")}record(e){u(this,n,"f").record(e)}testGetValue(e=u(this,n,"f").sendInPings[0]){return u(this,n,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=u(this,n,"f").sendInPings[0]){return u(this,n,"f").testGetNumRecordedErrors(e,t)}};n=new WeakMap},84592(e,t,i){i.d(t,{Uh:()=>o,X3:()=>l,cW:()=>c,ot:()=>LabeledMetric});var n=i(88729),r=i(27604),a=i(40351);let LabeledMetric=class LabeledMetric extends n.JW{constructor(e){super(e)}validate(e){return{type:n.iF.Success}}payload(){return this.inner}};let s=/^[a-z_][a-z0-9_-]{0,29}(\.[a-z_][a-z0-9_-]{0,29})*$/;function o(e,t){return`${e}/${t}`}function l(e){return e.split("/")[0]}function c(e){if(void 0===e.dynamicLabel)throw Error("This point should never be reached.");let t=o(e.baseIdentifier(),e.dynamicLabel);for(let i of e.sendInPings)if(r.o.metricsDatabase.hasMetric(e.lifetime,i,e.type,t))return t;let i=0;for(let t of e.sendInPings)i+=r.o.metricsDatabase.countByBaseIdentifier(e.lifetime,t,e.type,e.baseIdentifier());let n=!1;return i>=16?n=!0:e.dynamicLabel.length>61?(n=!0,r.o.errorManager.record(e,a.B.InvalidLabel,`Label length ${e.dynamicLabel.length} exceeds maximum of 61.`)):s.test(e.dynamicLabel)||(n=!0,r.o.errorManager.record(e,a.B.InvalidLabel,`Label must be snake_case, got '${e.dynamicLabel}'.`)),n?o(e.baseIdentifier(),"__other__"):t}},87484(e,t,i){i.d(t,{Ay:()=>p,Pc:()=>InternalUUIDMetricType});var n,r=i(62209),a=i(2277),s=i(27604),o=i(88729),l=i(40351),c=i(25740),d=function(e,t,i,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i},u=function(e,t,i,n){if("a"===i&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};let g=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;let UUIDMetric=class UUIDMetric extends o.JW{constructor(e){super(e)}validate(e){let t=(0,c.oI)(e);return t.type===o.iF.Error?t:g.test(e)?{type:o.iF.Success}:{type:o.iF.Error,errorMessage:`"${e}" is not a valid UUID`,errorType:l.B.InvalidValue}}payload(){return this.inner}};let InternalUUIDMetricType=class InternalUUIDMetricType extends r.v{constructor(e){super("uuid",e,UUIDMetric)}set(e){let t;if(this.shouldRecord(s.o.uploadEnabled)){e||(e=(0,a.Z3)());try{t=new UUIDMetric(e),s.o.metricsDatabase.record(this,t)}catch(e){e instanceof o.c1&&e.recordError(this)}}}generateAndSet(){if(!this.shouldRecord(s.o.uploadEnabled))return;let e=(0,a.Z3)();return this.set(e),e}testGetValue(e=this.sendInPings[0]){if((0,a.xU)("testGetValue","core.metrics.UUIDMetricType"))return s.o.metricsDatabase.getMetric(e,this)}};let p=class{constructor(e){n.set(this,void 0),d(this,n,new InternalUUIDMetricType(e),"f")}set(e){u(this,n,"f").set(e)}generateAndSet(){return u(this,n,"f").generateAndSet()}testGetValue(e=u(this,n,"f").sendInPings[0]){return u(this,n,"f").testGetValue(e)}testGetNumRecordedErrors(e,t=u(this,n,"f").sendInPings[0]){return u(this,n,"f").testGetNumRecordedErrors(e,t)}};n=new WeakMap},25740(e,t,i){i.d(t,{Hp:()=>c,LE:()=>d,oI:()=>g,wQ:()=>u});var n=i(88729),r=i(2277),a=i(84592),s=i(27604),o=i(40351),l=i(80849);function c(e,t){e.startsWith("labeled_")&&s.o.addSupportedMetric(e,a.ot);let i=s.o.getSupportedMetric(e);if(!i)throw Error(`Unable to create metric of unknown type "${e}".`);return new i(t)}function d(e,t){try{return c(e,t),!0}catch(e){return(0,l.A)("Glean.core.Metrics.utils",e.message,l.q.Error),!1}}function u(e,t=!0){return(0,r.Fq)(e)?(t?e<0:e<=0)?{type:n.iF.Error,errorMessage:`Expected positive value, got ${JSON.stringify(e)}`,errorType:o.B.InvalidValue}:{type:n.iF.Success}:{type:n.iF.Error,errorMessage:`Expected integer value, got ${JSON.stringify(e)}`}}function g(e){return(0,r.Kg)(e)?{type:n.iF.Success}:{type:n.iF.Error,errorMessage:`Expected string value, got ${JSON.stringify(e)}`}}},2277(e,t,i){let n;i.d(t,{b0:()=>p,zn:()=>v,cE:()=>D,Z3:()=>S,Fq:()=>b,bQ:()=>E,Et:()=>m,Gv:()=>g,IB:()=>M,xU:()=>T,Kg:()=>h,PK:()=>y,Lm:()=>f,qU:()=>w,EJ:()=>function e(t){if(h(t)||f(t)||m(t))return!0;if(g(t)){if(0===Object.keys(t).length)return!0;for(let i in t)return e(t[i])}return!!Array.isArray(t)&&t.every(t=>e(t))},Wl:()=>x,IY:()=>I});let r="u">typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),a=new Uint8Array(16),s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));let o=function(e,t,i){if(r&&!t&&!e)return r();let o=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="u">typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(a)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=o[e];return t}return function(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}(o)};var l=i(27604),c=i(40351),d=i(80849),u=i(88729);function g(e){return"object"==typeof e&&null!==e&&e.constructor===Object}function p(e){return void 0===e}function h(e){return"string"==typeof e}function f(e){return"boolean"==typeof e}function m(e){return"number"==typeof e&&!isNaN(e)}function b(e){return m(e)&&Number.isInteger(e)}function y(e){return"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&void 0}function v(e){return e.replace(/[^a-z0-9]+/gi,"-").toLowerCase()}function w(e){return/^(http|https):\/\/[a-zA-Z0-9._-]+(:\d+){0,1}(\/{0,1})$/i.test(e)}function I(e){return/^[a-z0-9-]{1,20}$/i.test(e)}function S(){return"u">typeof crypto?o():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function E(){return Math.round("u"<typeof performance?Date.now():performance.now())}function x(e,t,i){if(!h(t))throw new u.c1(`Expected string, got ${JSON.stringify(t)}`);let n=new TextEncoder,r=new TextDecoder("utf-8"),a=n.encode(t).slice(0,i),s=r.decode(a);return s!==t&&l.o.errorManager.record(e,c.B.InvalidOverflow,`Value length ${new Blob([t]).size} exceeds maximum of ${t.length} bytes.`),s}function T(e,t="core.utils"){return!!l.o.testing||((0,d.A)(t,[`Attempted to access test only method \`${e||"unknown"}\`,`,"but Glean is not in testing mode. Ignoring. Make sure to put Glean in testing mode","before accessing such methods, by calling `testResetGlean`."],d.q.Error),!1)}function D(...e){let t=e.reduce((e,t)=>e+t,0);return t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),t}function M(){return"u"<typeof window}},91610(e,t,i){let n;i.d(t,{A:()=>eo});var r,a,s,o,l,c,d,u,g,p,h,f=i(80849);(r=c||(c={}))[r.RecoverableFailure=0]="RecoverableFailure",r[r.UnrecoverableFailure=1]="UnrecoverableFailure",r[r.Success=2]="Success";let UploadResult=class UploadResult{constructor(e,t){this.result=e,this.status=t}};let Uploader=class Uploader{};let m=Uploader,b="platform.browser.FetchUploader";let BrowserFetchUploader=class BrowserFetchUploader extends m{constructor(){super(...arguments),this.timeoutMs=1e4}async post(e,t,i=!0){let n,r=new AbortController,a=setTimeout(()=>r.abort(),this.timeoutMs),s=t.asCompressedPayload();try{n=await fetch(e.toString(),{headers:s.headers,method:"POST",body:s.payload,keepalive:i,credentials:"omit",signal:r.signal,redirect:"error"})}catch(t){if(t instanceof DOMException)(0,f.A)(b,["Timeout while attempting to upload ping.\n",t],f.q.Error);else if(t instanceof TypeError){if(i)return this.post(e,s,!1);(0,f.A)(b,["Network error while attempting to upload ping.\n",t],f.q.Error)}else(0,f.A)(b,["Unknown error while attempting to upload ping.\n",t],f.q.Error);return clearTimeout(a),new UploadResult(0)}return clearTimeout(a),new UploadResult(2,n.status)}supportsCustomHeaders(){return!0}};let y=new BrowserFetchUploader;let BrowserSendBeaconUploader=class BrowserSendBeaconUploader extends m{constructor(){super(...arguments),this.timeoutMs=1e4}async post(e,t,i=!0){return navigator.sendBeacon(e,t.payload)?new UploadResult(2,200):(i&&(0,f.A)("platform.browser.SendBeaconUploader","The `sendBeacon` call was not serviced by the browser. Deleting data.",f.q.Error),new UploadResult(1))}supportsCustomHeaders(){return!1}};let v=new BrowserSendBeaconUploader;var w=i(27604);let I="platform.browser.SendBeaconFallbackUploader";let BrowserSendBeaconFallbackUploader=class BrowserSendBeaconFallbackUploader extends m{constructor(){super(...arguments),this.fetchUploader=y,this.sendBeaconUploader=v}async post(e,t){var i,n;if(!(null==(i=w.o.config)?void 0:i.sourceTags)&&!(null==(n=w.o.config)?void 0:n.debugViewTag)&&navigator&&navigator.sendBeacon){let i=await this.sendBeaconUploader.post(e,t,!1);if(2==i.result)return i;(0,f.A)(I,"The `sendBeacon` call was not serviced by the browser. Falling back to the `fetch` uploader.",f.q.Warn)}else(0,f.A)(I,"`sendBeacon` is not available. Falling back to the `fetch` uploader.",f.q.Warn);return this.fetchUploader.post(e,t)}supportsCustomHeaders(){return!1}};let S=new BrowserSendBeaconFallbackUploader;var E=i(2277);let x="platform.web.Storage";let WebStore=class WebStore{constructor(e){this.rootKey=e,this.logTag=`${x}.${e}`}get(e=[]){let t;if(!(0,E.IB)()){try{let i=localStorage.getItem(this.rootKey)||"{}",n=JSON.parse(i);t=e.length>0?function(e,t){if(0===t.length)throw Error("The index must contain at least one property to get.");let i=e;for(let e of t)if(!(0,E.Gv)(i)||!(e in i))return;else{let t=i[e];(0,E.EJ)(t)&&(i=t)}return i}(n,e):0===Object.keys(n).length?void 0:n}catch(e){(0,f.A)(x,["Unable to fetch value from local storage.",e],f.q.Error)}return this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo(),t}}update(e,t){if(!(0,E.IB)()){try{let i=localStorage.getItem(this.rootKey)||"{}",n=JSON.parse(i),r=function(e,t,i){if(0===t.length)throw Error("The index must contain at least one property to update.");let n={...e},r=n;for(let e of t.slice(0,t.length-1))(0,E.Gv)(r[e])||(r[e]={}),r=r[e];let a=t[t.length-1],s=i(r[a]);return r[a]=s,n}(n,e,t);localStorage.setItem(this.rootKey,JSON.stringify(r))}catch(e){(0,f.A)(x,["Unable to update value from local storage.",e],f.q.Error)}this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo()}}delete(e){if(!(0,E.IB)()){try{let t=localStorage.getItem(this.rootKey)||"{}",i=JSON.parse(t);if(0===e.length)localStorage.removeItem(this.rootKey);else try{let t=function(e,t){if(0===t.length)return{};let i={...e},n=i;for(let e of t.slice(0,t.length-1)){let i=n[e];if((0,E.Gv)(i))n=i;else throw Error(`Attempted to delete an entry from an inexistent index: ${JSON.stringify(t)}.`)}let r=t[t.length-1];return delete n[r],i}(i,e);localStorage.setItem(this.rootKey,JSON.stringify(t))}catch(t){(0,f.A)(this.logTag,[`Error attempting to delete key ${e.toString()} from storage. Ignoring.`,t],f.q.Warn)}}catch(e){(0,f.A)(x,["Unable to delete value from storage.",e],f.q.Error)}this.shouldUpdateSession(e)&&w.o.coreMetrics.updateSessionInfo()}}shouldUpdateSession(e){return!e.includes("session_id")&&!e.includes("session_count")}};var T=i(30994);let D="core.Config";let Configuration=class Configuration{constructor(e){var t;if(this.channel=null==e?void 0:e.channel,this.appBuild=null==e?void 0:e.appBuild,this.appDisplayVersion=null==e?void 0:e.appDisplayVersion,this.buildDate=null==e?void 0:e.buildDate,this.maxEvents=(null==e?void 0:e.maxEvents)||1,this.enableAutoPageLoadEvents=null==e?void 0:e.enableAutoPageLoadEvents,this.enableAutoElementClickEvents=null==e?void 0:e.enableAutoElementClickEvents,this.experimentationId=null==e?void 0:e.experimentationId,this.sessionLengthInMinutesOverride=null==e?void 0:e.sessionLengthInMinutesOverride,this.debug={},(null==e?void 0:e.serverEndpoint)&&!(0,E.qU)(e.serverEndpoint))throw Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} is an invalid URL.`);if(!w.o.testing&&(null==(t=null==e?void 0:e.serverEndpoint)?void 0:t.startsWith("http:")))throw Error(`Unable to initialize Glean, serverEndpoint ${e.serverEndpoint} must use the HTTPS protocol.`);this.serverEndpoint=e&&e.serverEndpoint?e.serverEndpoint:T.Gh,this.httpClient=null==e?void 0:e.httpClient}get logPings(){return this.debug.logPings||!1}set logPings(e){this.debug.logPings=e}get debugViewTag(){return this.debug.debugViewTag}set debugViewTag(e){(0,E.IY)(e||"")?this.debug.debugViewTag=e:(0,f.A)(D,[`"${e||""}" is not a valid \`debugViewTag\` value.`,"Please make sure the value passed satisfies the regex `^[a-zA-Z0-9-]{1,20}$`."],f.q.Error)}get sourceTags(){return this.debug.sourceTags}set sourceTags(e){if(!e||e.length<1||e.length>5)return void(0,f.A)(D,"A list of tags cannot contain more than 5 elements or less than one.",f.q.Error);for(let t of e){if(t.startsWith("glean"))return void(0,f.A)(D,"Tags starting with `glean` are reserved and must not be used.",f.q.Error);if(!(0,E.IY)(t))return}this.debug.sourceTags=e}};var M=i(69861);let P="core.Pings.Database";let PingsDatabase=class PingsDatabase{constructor(){this.store=new w.o.platform.Storage("pings")}attachObserver(e){this.observer=e}recordPing(e,t,i,n){let r={collectionDate:new Date().toISOString(),path:e,payload:i};n&&(r.headers=n),this.store.update([t],()=>r),this.observer&&this.observer.update(t,r)}deletePing(e){this.store.delete([e])}getAllPings(){let e=this.store.get(),t={};if((0,E.Gv)(e))for(let i in e){let n=e[i];!function(e){if((0,E.Gv)(e)){let t="collectionDate"in e&&(0,E.Kg)(e.collectionDate)&&(0,E.Et)(new Date(e.collectionDate).getTime()),i="path"in e&&(0,E.Kg)(e.path),n="payload"in e&&(0,E.EJ)(e.payload)&&(0,E.Gv)(e.payload),r=!("headers"in e)||(0,E.EJ)(e.headers)&&(0,E.Gv)(e.headers);return!!t&&!!i&&!!n&&!!r}return!1}(n)?((0,f.A)(P,`Unexpected data found in pings database: ${JSON.stringify(n,null,2)}. Deleting.`,f.q.Warn),this.store.delete([i])):t[i]=n}return Object.entries(t).sort(([e,{collectionDate:t}],[i,{collectionDate:n}])=>new Date(t).getTime()-new Date(n).getTime())}scanPendingPings(){if(this.observer)for(let[e,t]of this.getAllPingsWithoutSurplus())this.observer.update(e,t)}clearAll(){this.store.delete([])}getAllPingsWithoutSurplus(e=250,t=0xa00000){let i=this.getAllPings(),n=i.filter(([e,t])=>!A(t)).reverse(),r=i.filter(([e,t])=>A(t)),a=n.length;a>e&&(0,f.A)(P,[`More than ${e} pending pings in the pings database,`,`will delete ${a-e} old pings.`],f.q.Warn);let s=!1,o=0,l=0,c=[];for(let[i,r]of n){var d;o++,l+=(d=r,(0,M._u)(JSON.stringify(d)).length),!s&&l>t&&((0,f.A)(P,[`Pending pings database has reached the size quota of ${t} bytes,`,"outstanding pings will be deleted."],f.q.Warn),s=!0),o>e&&(s=!0),s?this.deletePing(i):c.unshift([i,r])}return[...r,...c]}};function A(e){return e.path.split("/")[3]===T.OM}(a=d||(d={}))[a.Incrementing=0]="Incrementing",a[a.Throttled=1]="Throttled";let RateLimiter=class RateLimiter{constructor(e=6e4,t=40,i=0,n){this.interval=e,this.maxCount=t,this.count=i,this.started=n}get elapsed(){if((0,E.b0)(this.started))return NaN;let e=(0,E.bQ)()-this.started;return e<0?NaN:e}reset(){this.started=(0,E.bQ)(),this.count=0}shouldReset(){return!!((0,E.b0)(this.started)||isNaN(this.elapsed)||this.elapsed>this.interval)}getState(){this.shouldReset()&&this.reset();let e=this.interval-this.elapsed;return this.count>=this.maxCount?{state:1,remainingTime:e}:(this.count++,{state:0})}};let Policy=class Policy{constructor(e=3,t=3,i=1048576){this.maxWaitAttempts=e,this.maxRecoverableFailures=t,this.maxPingBodySize=i}};let PingBodyOverflowError=class PingBodyOverflowError extends Error{constructor(e){super(e),this.name="PingBodyOverflow"}};let PingRequest=class PingRequest{constructor(e,t,i,n){this.identifier=e,this.headers=t,this.payload=i,this.maxBodySize=n}asCompressedPayload(){let e;if("gzip"==this.headers["Content-Encoding"])return this;let t=(0,M._u)(this.payload),i=this.headers;try{e=(0,M.u3)(t),i["Content-Encoding"]="gzip",i["Content-Length"]=e.length.toString()}catch(e){return this}if(e.length>this.maxBodySize)throw new PingBodyOverflowError(`Body for ping ${this.identifier} exceeds ${this.maxBodySize} bytes. Discarding.`);return new PingRequest(this.identifier,i,e,this.maxBodySize)}};let _="core.Upload.PingUploadWorker";let PingUploadWorker=class PingUploadWorker{constructor(e,t,i=new Policy){this.uploader=e,this.serverEndpoint=t,this.policy=i,this.isBlocking=!1}buildPingRequest(e){let t=e.headers||{};t={...e.headers,"Content-Type":"application/json; charset=utf-8",Date:new Date().toISOString(),"X-Telemetry-Agent":`Glean/5.0.7 (JS on ${w.o.platform.info.os()})`};let i=JSON.stringify(e.payload);if(i.length>this.policy.maxPingBodySize)throw new PingBodyOverflowError(`Body for ping ${e.identifier} exceeds ${this.policy.maxPingBodySize}bytes. Discarding.`);return t["Content-Length"]=i.length.toString(),new PingRequest(e.identifier,t,i,this.policy.maxPingBodySize)}async attemptPingUpload(e){try{let t=this.buildPingRequest(e);return this.uploader.post(`${this.serverEndpoint}${e.path}`,t)}catch(e){return(0,f.A)(_,["Error trying to build or post ping request:",e],f.q.Warn),new UploadResult(1)}}work(e,t){for(;;)try{let i=e();switch(i.type){case"upload":if(this.isBlocking)return;this.attemptPingUpload(i.ping).then(e=>{t(i.ping,e)}).catch(e=>{console.log(e)});continue;case"done":return}}catch(e){(0,f.A)(_,["IMPOSSIBLE: Something went wrong while processing ping upload tasks.",e],f.q.Error)}}blockUploading(){this.isBlocking=!0}resumeUploading(){this.isBlocking=!1}};(s=u||(u={})).Done="done",s.Wait="wait",s.Upload="upload";let C=()=>({type:"done"}),$="core.Upload.PingUploadManager";let PingUploadManager=class PingUploadManager{constructor(e,t,i=new Policy,n=new RateLimiter){this.pingsDatabase=t,this.policy=i,this.rateLimiter=n,this.recoverableFailureCount=0,this.waitAttemptCount=0,this.queue=[],this.processing=new Set,this.worker=new PingUploadWorker(e.httpClient?e.httpClient:w.o.platform.uploader,e.serverEndpoint,i),t.attachObserver(this)}getUploadTask(){let e=this.getUploadTaskInternal();return"wait"!==e.type&&this.waitAttemptCount>0&&(this.waitAttemptCount=0),"upload"!==e.type&&this.recoverableFailureCount>0&&(this.recoverableFailureCount=0),e}processPingUploadResponse(e,t){let{identifier:i}=e;this.processing.has(i)&&this.processing.delete(i);let{status:n,result:r}=t;if(n&&n>=200&&n<300){(0,f.A)($,`Ping ${i} successfully sent ${n}.`,f.q.Info),this.pingsDatabase.deletePing(i);return}if(1===r||n&&n>=400&&n<500){(0,f.A)($,`Unrecoverable upload failure while attempting to send ping ${i}. Error was: ${null!=n?n:"no status"}.`,f.q.Warn),this.pingsDatabase.deletePing(i);return}(0,f.A)($,[`Recoverable upload failure while attempting to send ping ${i}, will retry.`,`Error was: ${null!=n?n:"no status"}.`],f.q.Warn),this.recoverableFailureCount++,this.enqueuePing(e)}clearPendingPingsQueue(){this.queue=this.queue.filter(e=>A(e))}blockUploads(){this.worker.blockUploading()}resumeUploads(){this.worker.resumeUploading()}update(e,t){this.enqueuePing({identifier:e,...t}),this.worker.isBlocking||(this.processing.delete(e),this.pingsDatabase.deletePing(e)),this.worker.work(()=>this.getUploadTask(),(e,t)=>this.processPingUploadResponse(e,t))}enqueuePing(e){if(!this.processing.has(e.identifier)){for(let t of this.queue)if(t.identifier===e.identifier)return;this.queue.push(e)}}getUploadTaskInternal(){if(this.recoverableFailureCount>=this.policy.maxRecoverableFailures)return(0,f.A)($,"Glean has reached maximum recoverable upload failures for the current uploading window.",f.q.Debug),C();if(this.queue.length>0){let{state:e,remainingTime:t}=this.rateLimiter.getState();if(1===e)return((0,f.A)($,["Glean is currently throttled.",`Pending pings may be uploaded in ${(t||0)/1e3}s.`],f.q.Debug),this.waitAttemptCount++,this.waitAttemptCount>this.policy.maxWaitAttempts)?C():{type:"wait",remainingTime:t||0};let i=this.queue.shift();return this.processing.add(i.identifier),{type:"upload",ping:i}}return C()}};var U=i(87484),O=i(62209);(o=g||(g={})).Nanosecond="nanosecond",o.Microsecond="microsecond",o.Millisecond="millisecond",o.Second="second",o.Minute="minute",o.Hour="hour",o.Day="day";let k=g;var q=i(88729);let DatetimeMetric=class DatetimeMetric extends q.JW{constructor(e){super(e)}static fromDate(e,t){if(!(e instanceof Date))throw new q.c1(`Expected Date object, got ${JSON.stringify(e)}`);return new DatetimeMetric({timeUnit:t,timezone:e.getTimezoneOffset(),date:e.toISOString()})}get date(){return new Date(this.inner.date)}get timezone(){return this.inner.timezone}get timeUnit(){return this.inner.timeUnit}get dateISOString(){return this.inner.date}validate(e){if(!(0,E.Gv)(e)||3!==Object.keys(e).length)return{type:q.iF.Error,errorMessage:`Expected Glean datetime metric object, got ${JSON.stringify(e)}`};let t="timeUnit"in e&&(0,E.Kg)(e.timeUnit)&&Object.values(k).includes(e.timeUnit),i="timezone"in e&&(0,E.Et)(e.timezone),n="date"in e&&(0,E.Kg)(e.date)&&24===e.date.length&&!isNaN(Date.parse(e.date));return t&&i&&n?{type:q.iF.Success}:{type:q.iF.Error,errorMessage:`Invalid property on datetime metric, got ${JSON.stringify(e)}`}}payload(){let e,t,i=this.dateISOString.match(/\d+/g);if(!i||i.length<0)throw Error("IMPOSSIBLE: Unable to extract date information from DatetimeMetric.");let n=new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2]),parseInt(i[3])-this.timezone/60,parseInt(i[4]),parseInt(i[5]),parseInt(i[6])),r=(t=Math.abs(e=-(this.timezone/60*1)).toString().padStart(2,"0"),`${e>0?"+":"-"}${t}:00`),a=n.getFullYear().toString().padStart(2,"0"),s=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");if(this.timeUnit===k.Day)return`${a}-${s}-${o}${r}`;let l=n.getHours().toString().padStart(2,"0");if(this.timeUnit===k.Hour)return`${a}-${s}-${o}T${l}${r}`;let c=n.getMinutes().toString().padStart(2,"0");if(this.timeUnit===k.Minute)return`${a}-${s}-${o}T${l}:${c}${r}`;let d=n.getSeconds().toString().padStart(2,"0");if(this.timeUnit===k.Second)return`${a}-${s}-${o}T${l}:${c}:${d}${r}`;let u=n.getMilliseconds().toString().padStart(3,"0");return this.timeUnit===k.Millisecond?`${a}-${s}-${o}T${l}:${c}:${d}.${u}${r}`:this.timeUnit===k.Microsecond?`${a}-${s}-${o}T${l}:${c}:${d}.${u}000${r}`:`${a}-${s}-${o}T${l}:${c}:${d}.${u}000000${r}`}};let InternalDatetimeMetricType=class InternalDatetimeMetricType extends O.v{constructor(e,t){super("datetime",e,DatetimeMetric),this.timeUnit=t}set(e){if(!this.shouldRecord(w.o.uploadEnabled))return;let t=this.truncateDate(e);try{let e=DatetimeMetric.fromDate(t,this.timeUnit);w.o.metricsDatabase.record(this,e)}catch(e){e instanceof q.c1&&e.recordError(this)}}truncateDate(e){e||(e=new Date);let t=e;switch(this.timeUnit){case k.Day:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setMilliseconds(0);case k.Hour:t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0);case k.Minute:t.setMilliseconds(0),t.setSeconds(0);case k.Second:t.setMilliseconds(0)}return t}testGetValueAsDatetimeMetric(e,t){if((0,E.xU)(t,"core.metrics.DatetimeMetricType")){let t=w.o.metricsDatabase.getMetric(e,this);if(t)return new DatetimeMetric(t)}}testGetValueAsString(e=this.sendInPings[0]){let t=this.testGetValueAsDatetimeMetric(e,"testGetValueAsString");return t?t.payload():void 0}testGetValue(e=this.sendInPings[0]){let t=this.testGetValueAsDatetimeMetric(e,"testGetValue");return t?t.date:void 0}};new WeakMap;var L=i(25740);let StringMetric=class StringMetric extends q.JW{constructor(e){super(e)}validate(e){return(0,L.oI)(e)}payload(){return this.inner}};let InternalStringMetricType=class InternalStringMetricType extends O.v{constructor(e){super("string",e,StringMetric)}set(e){if(this.shouldRecord(w.o.uploadEnabled))try{let t=(0,E.Wl)(this,e,100),i=new StringMetric(t);w.o.metricsDatabase.record(this,i)}catch(e){e instanceof q.c1&&e.recordError(this)}}testGetValue(e=this.sendInPings[0]){if((0,E.xU)("testGetValue","core.metrics.StringMetricType"))return w.o.metricsDatabase.getMetric(e,this)}};new WeakMap;let z="core.metrics.CounterMetricType";let CounterMetric=class CounterMetric extends q.JW{constructor(e){super(e)}validate(e){return(0,L.wQ)(e,!1)}payload(){return this.inner}saturatingAdd(e){let t=this.validateOrThrow(e);this.inner=(0,E.cE)(this.inner,t)}};let InternalCounterMetricType=class InternalCounterMetricType extends O.v{constructor(e){super("counter",e,CounterMetric)}add(e){if(this.shouldRecord(w.o.uploadEnabled)){(0,E.b0)(e)&&(e=1);try{w.o.metricsDatabase.transform(this,this.transformFn(e))}catch(e){e instanceof q.c1&&e.recordError(this)}}}transformFn(e){return t=>{let i=new CounterMetric(e);if(t)try{i.saturatingAdd(t)}catch(e){(0,f.A)(z,`Unexpected value found in storage for metric ${this.name}: ${JSON.stringify(t)}. Overwriting.`)}return i}}testGetValue(e=this.sendInPings[0]){if((0,E.xU)("testGetValue",z))return w.o.metricsDatabase.getMetric(e,this)}};new WeakMap;let CoreMetrics=class CoreMetrics{constructor(){this.clientId=new U.Pc({name:"client_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.firstRunDate=new InternalDatetimeMetricType({name:"first_run_date",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1},k.Day),this.os=new InternalStringMetricType({name:"os",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.osVersion=new InternalStringMetricType({name:"os_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.architecture=new InternalStringMetricType({name:"architecture",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.locale=new InternalStringMetricType({name:"locale",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appChannel=new InternalStringMetricType({name:"app_channel",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appBuild=new InternalStringMetricType({name:"app_build",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.appDisplayVersion=new InternalStringMetricType({name:"app_display_version",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1}),this.buildDate=new InternalDatetimeMetricType({name:"build_date",category:"",sendInPings:["glean_client_info"],lifetime:"application",disabled:!1},"second"),this.sessionId=new U.Pc({name:"session_id",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1}),this.sessionCount=new InternalCounterMetricType({name:"session_count",category:"",sendInPings:["glean_client_info"],lifetime:"user",disabled:!1})}initialize(){!(!w.o.testing&&(0,E.IB)())&&(this.initializeClientId(),this.initializeFirstRunDate(),this.updateSessionInfo(),this.os.set(w.o.platform.info.os()),this.osVersion.set(w.o.platform.info.osVersion()),this.architecture.set(w.o.platform.info.arch()),this.locale.set(w.o.platform.info.locale()),this.appBuild.set(w.o.config.appBuild||"Unknown"),this.appDisplayVersion.set(w.o.config.appDisplayVersion||"Unknown"),w.o.config.channel&&this.appChannel.set(w.o.config.channel),w.o.config.buildDate&&this.buildDate.set())}updateSessionInfo(){if(!(0,E.IB)()){if(w.o.metricsDatabase.getMetric(T.Tv,this.sessionId))try{(function(e=30){let t=null;try{t=localStorage.getItem("glean_session_last_active")}catch(e){console.warn(e)}let i=new Date(Number(t)),n=new Date;return n.setMinutes(n.getMinutes()-e),n>i})(w.o.config.sessionLengthInMinutesOverride)&&this.generateNewSession()}catch(e){this.generateNewSession()}else this.generateNewSession();try{localStorage.setItem("glean_session_last_active",Date.now().toString())}catch(e){console.warn(e)}}}initializeClientId(){let e=!1,t=w.o.metricsDatabase.getMetric(T.Tv,this.clientId);if(t)try{(0,L.Hp)("uuid",t).payload()===T.Kp&&(e=!0)}catch(t){(0,f.A)("core.InternalMetrics","Unexpected value found for Glean clientId. Ignoring.",f.q.Warn),e=!0}else e=!0;e&&this.clientId.set((0,E.Z3)())}initializeFirstRunDate(){w.o.metricsDatabase.getMetric(T.Tv,this.firstRunDate)||this.firstRunDate.set()}generateNewSession(){this.sessionId.generateAndSet(),this.sessionCount.add()}};let B="core.Pings.Maker",R=function(e,t,i){let n=function(e,t){let i=w.o.eventsDatabase.getPingEvents(e.name,!0),n=w.o.metricsDatabase.getPingMetrics(e.name,!0);if(!n&&!i){if(!e.sendIfEmpty)return void(0,f.A)(B,`Storage for ${e.name} empty. Bailing out.`,f.q.Info);(0,f.A)(B,`Storage for ${e.name} empty. Ping will still be sent.`,f.q.Info)}e.includeClientId&&w.o.config.experimentationId&&(n=void 0!==n?{...n,string:{...(null==n?void 0:n.string)||void 0,"glean.client.annotation.experimentation_id":w.o.config.experimentationId}}:{string:{"glean.client.annotation.experimentation_id":w.o.config.experimentationId}});let r=n?{metrics:n}:{},a=function(e,t){let i=function(e){let t=new InternalCounterMetricType({category:"",name:`${e.name}#sequence`,sendInPings:[T.cp],lifetime:"user",disabled:!1}),i=w.o.metricsDatabase.getMetric(T.cp,t);if(t.add(1),i)try{return new CounterMetric(i).payload()}catch(t){(0,f.A)(B,`Unexpected value found for sequence number in ping ${e.name}. Ignoring.`,f.q.Warn)}return 0}(e),{startTime:n,endTime:r}=function(e){let t,i,{startTimeMetric:n,startTime:r}=(t=new InternalDatetimeMetricType({category:"",name:`${e.name}#start`,sendInPings:[T.cp],lifetime:"user",disabled:!1},k.Minute),i=w.o.metricsDatabase.getMetric(T.cp,t),{startTimeMetric:t,startTime:i?new DatetimeMetric(i):DatetimeMetric.fromDate(w.o.startTime,k.Minute)}),a=new Date;n.set(a);let s=DatetimeMetric.fromDate(a,k.Minute);return{startTime:r.payload(),endTime:s.payload()}}(e),a={seq:i,start_time:n,end_time:r};return t&&(a.reason=t),a}(e,t),s=function(e){let t=w.o.metricsDatabase.getPingMetrics(T.Tv,!0);t||((0,f.A)(B,"Empty client info data. Will submit anyways.",f.q.Warn),t={});let i={telemetry_sdk_build:"5.0.7"};for(let e in t)i={...i,...t[e]};return e.includeClientId||(delete i.client_id,delete i.session_id),i}(e);return{...r,...i?{events:i}:{},ping_info:a,client_info:s}}(t,i);if(!n)return;w.o.config.logPings&&(0,f.A)(B,JSON.stringify(n,null,2),f.q.Info);let r=function(){let e={};if(w.o.config.debugViewTag&&(e["X-Debug-ID"]=w.o.config.debugViewTag),w.o.config.sourceTags&&(e["X-Source-Tags"]=w.o.config.sourceTags.toString()),Object.keys(e).length>0)return e}();w.o.pingsDatabase.recordPing(`/submit/${w.o.applicationId}/${t.name}/1/${e}`,e,n,r)},V="core.Pings.PingType";let InternalPingType=class InternalPingType{constructor(e){var t;this.name=e.name,this.includeClientId=e.includeClientId,this.sendIfEmpty=e.sendIfEmpty,this.reasonCodes=null!=(t=e.reasonCodes)?t:[],this.preciseTimestamps=e.preciseTimestamps}submit(e){this.testCallback?this.testCallback(e).then(()=>{this.internalSubmit(e,this.resolveTestPromiseFunction)}).catch(t=>{(0,f.A)(V,[`There was an error validating "${this.name}" (${null!=e?e:"no reason"}):`,t],f.q.Error),this.internalSubmit(e,this.rejectTestPromiseFunction)}):this.internalSubmit(e)}internalSubmit(e,t){if(!w.o.initialized)return void(0,f.A)(V,"Glean must be initialized before submitting pings.",f.q.Info);if(!w.o.uploadEnabled&&this.name!==T.OM)return void(0,f.A)(V,"Glean disabled: not submitting pings. Glean may still submit the deletion-request ping.",f.q.Info);let i=e;e&&!this.reasonCodes.includes(e)&&((0,f.A)(V,`Invalid reason code ${e} from ${this.name}. Ignoring.`,f.q.Warn),i=void 0),R((0,E.Z3)(),this,i),t&&(t(),this.resolveTestPromiseFunction=void 0,this.rejectTestPromiseFunction=void 0,this.testCallback=void 0)}async testBeforeNextSubmit(e){if((0,E.xU)("testBeforeNextSubmit",V))return this.testCallback?void(0,f.A)(V,`There is an existing test call for ping "${this.name}". Ignoring.`,f.q.Error):new Promise((t,i)=>{this.resolveTestPromiseFunction=t,this.rejectTestPromiseFunction=i,this.testCallback=e})}};new WeakMap;let CorePings=class CorePings{constructor(){this.deletionRequest=new InternalPingType({name:T.OM,includeClientId:!0,sendIfEmpty:!0,reasonCodes:["at_init","set_upload_enabled"]}),this.events=new InternalPingType({name:"events",includeClientId:!0,sendIfEmpty:!1,reasonCodes:["startup","max_capacity"]})}};let G="core.Metrics.Database",N="reserved#",F=`glean.${N}`;let MetricsDatabase=class MetricsDatabase{constructor(){this.userStore=new w.o.platform.Storage("userLifetimeMetrics"),this.pingStore=new w.o.platform.Storage("pingLifetimeMetrics"),this.appStore=new w.o.platform.Storage("appLifetimeMetrics")}record(e,t){this.transform(e,()=>t)}transform(e,t){if(e.disabled)return;let i=this.chooseStore(e.lifetime),n=e.identifier();for(let r of e.sendInPings){let a=e=>t(e).get();i.update([r,e.type,n],a)}}hasMetric(e,t,i,n){let r=this.chooseStore(e).get([t,i,n]);return!(0,E.b0)(r)}countByBaseIdentifier(e,t,i,n){let r=this.chooseStore(e).get([t,i]);return(0,E.b0)(r)?0:Object.keys(r).filter(e=>e.startsWith(n)).length}getMetric(e,t){let i=this.chooseStore(t.lifetime),n=t.identifier(),r=i.get([e,t.type,n]);if((0,E.b0)(r)||(0,L.LE)(t.type,r))return r;(0,f.A)(G,`Unexpected value found for metric ${n}: ${JSON.stringify(r)}. Clearing.`,f.q.Error),i.delete([e,t.type,n])}getPingMetrics(e,t){let i=this.getCorrectedPingData(e,"user"),n=this.getCorrectedPingData(e,"ping"),r=this.getCorrectedPingData(e,"application");t&&Object.keys(n).length>0&&this.clear("ping",e);let a={};for(let e of[i,n,r])for(let t in e)for(let i in e[t])i.startsWith(F)||(i.includes("/")?this.processLabeledMetric(a,t,i,e[t][i]):a[t]={...a[t],[i]:e[t][i]});if(0!==Object.keys(a).length){let e={};for(let t in a){let i=a[t];for(let n in e[t]={},i){let r=(0,L.Hp)(t,i[n]);e[t][n]=r.payload()}}return e}}clear(e,t){this.chooseStore(e).delete(t?[t]:[])}clearAll(){this.userStore.delete([]),this.pingStore.delete([]),this.appStore.delete([])}chooseStore(e){switch(e){case"user":return this.userStore;case"ping":return this.pingStore;case"application":return this.appStore}}getCorrectedPingData(e,t){let i=this.chooseStore(t),n=i.get([e]);if((0,E.b0)(n))return{};if(!(0,E.Gv)(n))return(0,f.A)(G,`Invalid value found in storage for ping "${e}". Deleting.`,f.q.Debug),i.delete([e]),{};let r={};for(let t in n){let a=n[t];if(!(0,E.Gv)(a)){(0,f.A)(G,`Unexpected data found in storage for metrics of type "${t}" in ping "${e}". Deleting.`,f.q.Debug),i.delete([e,t]);continue}for(let n in a){if(!(0,L.LE)(t,a[n])){(0,f.A)(G,`Invalid value "${JSON.stringify(a[n])}" found in storage for metric "${n}". Deleting.`,f.q.Debug),i.delete([e,t,n]);continue}r[t]||(r[t]={}),r[t][n]=a[n]}}return r}processLabeledMetric(e,t,i,n){let r=`labeled_${t}`,a=i.split("/",2),s=a[0],o=a[1];if(r in e&&s in e[r]){let t=e[r][s];e[r][s]={...t,[o]:n}}else e[r]={...e[r],[s]:{[o]:n}}}};var W=i(40351),j=i(67867),J=i(82006);let K="core.Metric.EventsDatabase";function H(e,t=w.o.startTime){Z(e).record({[T.zh]:t.toISOString()},0)}function X(e){(0,E.Kg)(e)||(e="");let t=new Date(e);if(isNaN(t.getTime()))throw Error(`Error attempting to generate Date object from string: ${e}`);return t}function Q(e){return new InternalCounterMetricType({...{category:"glean",name:`${N}execution_counter`},sendInPings:e.filter(e=>"events"!==e),lifetime:"ping",disabled:!1})}function Z(e){return new j.C({category:"glean",name:"restarted",sendInPings:e.filter(e=>"events"!==e),lifetime:"ping",disabled:!1},[T.zh])}let EventsDatabase=class EventsDatabase{constructor(){this.initialized=!1,this.eventsStore=new w.o.platform.Storage("events")}initialize(){var e;if(this.initialized)return;let t=this.getAvailableStoreNames();if(t.includes("events")){let t=null!=(e=this.eventsStore.get(["events"]))?e:[];t.length>0&&t.length>=w.o.config.maxEvents&&w.o.corePings.events.submit("startup")}Q(t).add(1),H(t),this.initialized=!0}record(e,t){if(!e.disabled)for(let i of e.sendInPings){let e=Q([i]),n=w.o.metricsDatabase.getMetric(i,e);n||(e.add(1),n=1,H([i],new Date)),t.addExtra(T.HT,n);let r=0,a=e=>{let i=null!=e?e:[];return i.push(t.get()),r=i.length,i};this.eventsStore.update([i],a),"events"===i&&r>=w.o.config.maxEvents&&w.o.corePings.events.submit("max_capacity")}}getEvents(e,t){let i=this.getAndValidatePingData(e);if(0!==i.length)return i.filter(e=>e.get().category===t.category&&e.get().name===t.name).map(e=>e.withoutReservedExtras())}getPingEvents(e,t){let i=this.getAndValidatePingData(e);if(t&&Object.keys(i).length>0&&this.eventsStore.delete([e]),0===i.length)return;let n=this.prepareEventsPayload(e,i);if(n.length>0)return n}clearAll(){this.eventsStore.delete([])}getAvailableStoreNames(){let e=this.eventsStore.get([]);return(0,E.b0)(e)?[]:Object.keys(e)}getAndValidatePingData(e){let t=this.eventsStore.get([e]);return(0,E.b0)(t)?[]:Array.isArray(t)?t.reduce((e,t)=>{try{let i=new J.j(t);return[...e,i]}catch(i){return(0,f.A)(K,`Unexpected data found in events storage: ${JSON.stringify(t)}. Ignoring.`),e}},[]):((0,f.A)(K,`Unexpected value found for ping ${e}: ${JSON.stringify(t)}. Clearing.`,f.q.Error),this.eventsStore.delete([e]),[])}prepareEventsPayload(e,t){var i,n,r,a;let s,o=t.sort((e,t)=>{var i,n;let r=Number(null==(i=e.get().extra)?void 0:i[T.HT]),a=Number(null==(n=t.get().extra)?void 0:n[T.HT]);return r!==a?r-a:e.get().timestamp-t.get().timestamp});try{s=X(null==(i=o[0].get().extra)?void 0:i[T.zh]),o.shift()}catch(e){s=w.o.startTime}let l=(null==(n=o[0])?void 0:n.get().timestamp)||0,c=0;for(let[t,i]of o.entries()){let n;try{let n=X(null==(r=i.get().extra)?void 0:r[T.zh]),a=n.getTime()-s.getTime();s=n;let l=c+a,d=o[t-1].get().timestamp;l<=d?(c=d+1,w.o.errorManager.record(Z([e]),W.B.InvalidValue,`Invalid time offset between application sessions found for ping "${e}". Ignoring.`)):c=l}catch(e){}n=1===Number((null==(a=i.get().extra)?void 0:a[T.HT])||1)?i.get().timestamp-l:i.get().timestamp+c,o[t]=new J.j({category:i.get().category,name:i.get().name,timestamp:n,extra:i.get().extra})}return(o=function(e){for(var t,i,n;e.length&&(null==(n=null==(i=null==(t=e[e.length-1])?void 0:t.get())?void 0:i.extra)?void 0:n[T.zh]);)e.pop();return e}(o)).map(e=>e.payload())}};var Y=i(84592);function ee(e,t){let i=e.baseIdentifier(),n=(0,Y.X3)(i);return new InternalCounterMetricType({name:(0,Y.Uh)(t,n),category:"glean.error",lifetime:"ping",sendInPings:e.sendInPings,disabled:!1})}let ErrorManager=class ErrorManager{record(e,t,i,n=1){let r,a=ee(e,t);(0,f.A)((r=e.type.charAt(0).toUpperCase()+e.type.slice(1),`core.metrics.${r}`),[`${e.baseIdentifier()}:`,i]),n>0&&a.add(n)}testGetNumRecordedErrors(e,t,i){return ee(e,t).testGetValue(i)||0}};var et=i(34388);let ei="core.Glean";(l=p||(p={})).DebugTag="DebugTag",l.SourceTags="SourceTags",l.LogPings="LogPings";let en=(e,t)=>{let i=`Glean.${e.toString()}`;try{switch(e){case p.DebugTag:sessionStorage.setItem(i,t);break;case p.LogPings:sessionStorage.setItem(i,t.toString());break;case p.SourceTags:sessionStorage.setItem(i,t.join(","))}}catch(e){console.warn(e)}},er=e=>{try{return sessionStorage.getItem(`Glean.${e.toString()}`)||void 0}catch(e){console.warn(e);return}};!function(e){function t(){w.o.uploadEnabled=!0,e.pingUploader.resumeUploads()}function i(e){w.o.uploadEnabled=!1,w.o.corePings.deletionRequest.submit(e?"at_init":"set_upload_enabled"),n()}function n(){let t;e.pingUploader.clearPendingPingsQueue();try{t=new DatetimeMetric(w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.firstRunDate)).date}catch(e){t=new Date}w.o.eventsDatabase.clearAll(),w.o.metricsDatabase.clearAll(),w.o.pingsDatabase.clearAll(),w.o.uploadEnabled=!0,w.o.coreMetrics.clientId.set(T.Kp),w.o.coreMetrics.firstRunDate.set(t),w.o.uploadEnabled=!1}e.initialize=function(r,a,s){let o,l,c;if(w.o.initialized)return void(0,f.A)(ei,"Attempted to initialize Glean, but it has already been initialized. Ignoring.",f.q.Warn);if(!(0,E.Kg)(r))return void(0,f.A)(ei,"Unable to initialize Glean, applicationId must be a string.",f.q.Error);if(!(0,E.Lm)(a))return void(0,f.A)(ei,"Unable to initialize Glean, uploadEnabled must be a boolean.",f.q.Error);if(0===r.length)return void(0,f.A)(ei,"Unable to initialize Glean, applicationId cannot be an empty string.",f.q.Error);if(!w.o.platform)return void(0,f.A)(ei,"Unable to initialize Glean, platform has not been set.",f.q.Error);if(w.o.coreMetrics=new CoreMetrics,w.o.corePings=new CorePings,w.o.applicationId=(0,E.zn)(r),w.o.config=new Configuration(s),(o=er(p.LogPings))&&(e.preInitLogPings=(0,E.PK)(o)),(l=er(p.DebugTag))&&(e.preInitDebugViewTag=l),(c=er(p.SourceTags))&&(e.preInitSourceTags=c.split(",")),e.preInitLogPings&&(w.o.config.logPings=e.preInitLogPings),e.preInitDebugViewTag&&(w.o.config.debugViewTag=e.preInitDebugViewTag),e.preInitSourceTags&&(w.o.config.sourceTags=e.preInitSourceTags),w.o.metricsDatabase=new MetricsDatabase,w.o.eventsDatabase=new EventsDatabase,w.o.pingsDatabase=new PingsDatabase,w.o.errorManager=new ErrorManager,e.pingUploader=new PingUploadManager(w.o.config,w.o.pingsDatabase),w.o.initialized=!0,w.o.uploadEnabled=a,w.o.eventsDatabase.initialize(),a)w.o.metricsDatabase.clear("application"),t(),w.o.coreMetrics.initialize(),(null==s?void 0:s.enableAutoPageLoadEvents)&&et.A.pageLoad(),(null==s?void 0:s.enableAutoElementClickEvents)&&document.addEventListener("click",e=>{et.A.handleClickEvent(e)});else{let e=w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.clientId);e?e!==T.Kp&&i(!0):n()}w.o.pingsDatabase.scanPendingPings()},e.setUploadEnabled=function(e){w.o.initialized?(0,E.Lm)(e)?w.o.uploadEnabled!==e&&(e?(t(),w.o.coreMetrics.initialize()):i(!1)):(0,f.A)(ei,"Unable to change upload state, new value must be a boolean. Ignoring.",f.q.Error):(0,f.A)(ei,["Changing upload enabled before Glean is initialized is not supported.\n","Pass the correct state into `initialize`.\n","See documentation at https://mozilla.github.io/glean/book/user/general-api.html#initializing-the-glean-sdk`"],f.q.Error)},e.setExperimentationId=function(e){w.o.config.experimentationId=e},e.setLogPings=function(t){w.o.initialized?w.o.config.logPings=t:e.preInitLogPings=t},e.setDebugViewTag=function(t){w.o.initialized?w.o.config.debugViewTag=t:e.preInitDebugViewTag=t},e.setSourceTags=function(t){w.o.initialized?w.o.config.sourceTags=t:e.preInitSourceTags=t},e.setPlatform=function(e){w.o.initialized||(w.o.isPlatformSet()&&w.o.platform.name!==e.name&&!w.o.testing&&(0,f.A)(ei,[`IMPOSSIBLE: Attempted to change Glean's targeted platform",
            "from "${w.o.platform.name}" to "${e.name}". Ignoring.`],f.q.Error),w.o.platform=e)}}(h||(h={}));let ea=!1;try{ea="u">typeof window&&void 0!==window.sessionStorage}catch(e){console.error("No session storage available",e)}ea&&(window.Glean={setLogPings:e=>{en(p.LogPings,e),h.setLogPings(e),console.log("Pings will be logged to the console until this tab is closed.")},setDebugViewTag:e=>{en(p.DebugTag,e),h.setDebugViewTag(e),console.log("Pings will be sent to the Debug Ping Viewer until this tab is closed. Pings can be found here: https://debug-ping-preview.firebaseapp.com/.")},setSourceTags:e=>{en(p.SourceTags,e),h.setSourceTags(e),console.log("Pings will be given the specified tags until the tab is closed.")},debugSession:()=>{let e=w.o.metricsDatabase.getMetric(T.Tv,w.o.coreMetrics.sessionId);e&&"string"==typeof e&&w.o.config.debugViewTag?window.open(`https://debug-ping-preview.firebaseapp.com/stream/${w.o.config.debugViewTag}#${e}`,"_blank"):console.info("You must set a debug tag via `window.Glean.setDebugViewTag` before debugging your session.")}});let es=h,eo=(n={Storage:WebStore,uploader:S,info:{os(){let e;return(e=navigator&&navigator.userAgent?navigator.userAgent:"Unknown").includes("Windows")?"Windows":/tvOS/i.test(e)?"TvOS":/Watch( OS)?/i.test(e)?"WatchOS":/iPhone|iPad|iOS/i.test(e)?"iOS":/Mac OS X|macOS/i.test(e)?"Darwin":/Android/i.test(e)?"Android":/CrOS/i.test(e)?"ChromeOS":/WebOS/i.test(e)?"WebOS":/Linux/i.test(e)?"Linux":/OpenBSD/i.test(e)?"OpenBSD":/FreeBSD/i.test(e)?"FreeBSD":/NetBSD/i.test(e)?"NetBSD":/SunOS/i.test(e)?"SunOS":/AIX/i.test(e)?"IBM_AIX":"Unknown"},osVersion:()=>"Unknown",arch:()=>"Unknown",locale:()=>navigator&&navigator.language?navigator.language:"und"},timer:{setTimeout,clearTimeout},name:"web"},{initialize(e,t,i){es.setPlatform(n),es.initialize(e,t,i)},setUploadEnabled(e){es.setUploadEnabled(e)},setLogPings(e){es.setLogPings(e)},setDebugViewTag(e){es.setDebugViewTag(e)},setSourceTags(e){es.setSourceTags(e)}})}};
//# sourceMappingURL=8903.ce3ee42276c345b9.js.map